<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--  
    Document Title
    =============================================
    -->
    <title>Hanoi Food Bank</title>
    <!--  
    Favicons
    =============================================
    -->
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="assets/images/favicons/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="assets/images/favicons/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="assets/images/favicons/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="assets/images/favicons/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="assets/images/favicons/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="assets/images/favicons/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="assets/images/favicons/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="assets/images/favicons/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/images/favicons/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="assets/images/favicons/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/images/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="assets/images/favicons/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/images/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="assets/images/favicons/ms-icon-144x144.png"
    />
    <meta name="theme-color" content="#ffffff" />
    <!--  
    Stylesheets
    =============================================
    
    -->
    <!-- Default stylesheets-->
    <link
      href="assets/lib/bootstrap/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Template specific stylesheets-->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Volkhov:400i"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800"
      rel="stylesheet"
    />
    <link href="assets/lib/animate.css/animate.css" rel="stylesheet" />
    <link
      href="assets/lib/components-font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link href="assets/lib/et-line-font/et-line-font.css" rel="stylesheet" />
    <link href="assets/lib/flexslider/flexslider.css" rel="stylesheet" />
    <link
      href="assets/lib/owl.carousel/dist/assets/owl.carousel.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/lib/owl.carousel/dist/assets/owl.theme.default.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/lib/magnific-popup/dist/magnific-popup.css"
      rel="stylesheet"
    />
    <link
      href="assets/lib/simple-text-rotator/simpletextrotator.css"
      rel="stylesheet"
    />
    <!-- Main stylesheet and color file-->
    <link href="assets/css/style.css" rel="stylesheet" />
    <link
      id="color-scheme"
      href="assets/css/colors/default.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/validator.css" />
    <link rel="stylesheet" href="./assets/css/repository.css" />

    <!-- paypal -->
    <script src="https://www.paypal.com/sdk/js?client-id=ARfjvhupmZbesvNCgtE5AJV8zCxdME-gej0ajX-4aBkkIpdstLDqPA1dqw3oZIozjICO5A78qlEIw1OL&components=buttons"></script>
    <script src="https://www.paypalobjects.com/api/checkout.js"></script>
  </head>
  <body data-spy="scroll" data-target=".onpage-navigation" data-offset="60">
    <main>
      <div class="page-loader">
        <div class="loader">Loading...</div>
      </div>
      <header id="header"></header>
      <div class="main">
        <section
          class="module bg-dark-30"
          data-background="assets/images/gallery/bg/bg4.jpg"
        >
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
                <h1 class="module-title font-alt mb-0">Login-Register</h1>
              </div>
            </div>
          </div>
        </section>
        <section class="module">
          <div class="container">
            <div class="row">
              <div class="col-sm-5 col-sm-offset-1 mb-sm-40">
                <div class="loginform">
                  <h4 class="font-alt">Login</h4>
                  <hr class="divider-w mb-10" />
                  <form class="form" id="form-login">
                    <!-- <div class="form-group">
                      <input class="form-control" id="phone-login" type="tel" name="phone" placeholder="Phone Number"/>
                      <span class="form-message"></span>
                    </div> -->
                    <div class="form-group">
                      <input
                        class="form-control"
                        id="username-login"
                        type="text"
                        name="username-login"
                        placeholder="Email"
                      />
                      <span class="form-message"></span>
                    </div>
                    <div class="form-group">
                      <input
                        class="form-control"
                        id="password-login"
                        type="password"
                        name="password-login"
                        placeholder="Password"
                      />
                      <span class="form-message"></span>
                    </div>
                    <div class="form-group">
                      <button
                        class="btn btn-round btn-b"
                        type="button"
                        id="btnLogin"
                      >
                        Login
                      </button>
                    </div>
                    <div class="form-group">
                      <a onclick="forgotpassword()">Forgot Password?</a>
                    </div>
                  </form>
                </div>
                <div class="forgot-password">
                  <h4 class="font-alt">Forgot Password</h4>
                  <hr class="divider-w mb-10" />
                  <form class="form" id="form-forgot">
                    <div class="form-group">
                      <input
                        class="form-control"
                        id="username-forgot"
                        type="text"
                        name="username"
                        placeholder="Username"
                        disabled=""
                      />
                      <span class="form-message"></span>
                    </div>
                    <div class="form-group">
                      <input
                        class="form-control"
                        id="password-forgot"
                        type="password"
                        name="password"
                        placeholder="Password"
                        disabled=""
                      />
                      <span class="form-message"></span>
                    </div>
                    <div class="form-group">
                      <button class="btn btn-round btn-b">Forgot</button>
                    </div>
                    <div class="form-group">
                      <a onclick="loginform()">Login?</a>
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-sm-5">
                <h4 class="font-alt">Register</h4>
                <hr class="divider-w mb-10" />
                <form class="form" id="form-register" name="form-register">
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="fullname-register"
                      type="text"
                      name="fullname-register"
                      placeholder="Full Name"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="email-register"
                      type="text"
                      name="email-register"
                      placeholder="Email"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="phone-register"
                      type="text"
                      name="phone-register"
                      placeholder="Phone Number"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div x-data="formApp">
                    <div
                      class="form-group"
                      @click.outside="provinceListShown = false"
                    >
                      <input
                        class="form-control"
                        x-model.trim="provinceSearch"
                        id="province"
                        name="province"
                        placeholder="Province"
                        @focus="startSearchingProvince"
                        autocomplete="off"
                      />
                      <span class="form-message"></span>
                      <div
                        class="z-10 max-h-48 w-full bg-gray-100 overflow-y-auto shadow"
                        x-show="provinceListShown && filteredProvinces.length"
                      >
                        <ul class="list-none">
                          <template
                            x-for="(item, idx) of filteredProvinces"
                            :key="idx"
                          >
                            <li
                              x-html="highlightName(item)"
                              class="px-2 py-1 cursor-pointer bg-white hover:bg-gray-100 seperate_line"
                              @click="selectProvince(item)"
                            ></li>
                          </template>
                        </ul>
                      </div>
                    </div>
                    <div
                      class="form-group"
                      @click.outside="districtListShown = false"
                    >
                      <input
                        class="form-control"
                        x-model.trim="districtSearch"
                        id="district"
                        name="district"
                        placeholder="District"
                        @focus="startSearchingDistrict"
                        @input.debounce="searchDistrictOnTyping"
                        autocomplete="off"
                      />
                      <span class="form-message"></span>
                      <div
                        class="z-10 max-h-48 w-full bg-gray-100 overflow-y-auto shadow"
                        x-show="districtListShown && filteredDistricts.length"
                      >
                        <ul class="list-none">
                          <template
                            x-for="(item, idx) of filteredDistricts"
                            :key="idx"
                          >
                            <li
                              x-html="highlightName(item)"
                              class="px-2 py-1 cursor-pointer bg-white hover:bg-gray-100 seperate_line"
                              @click="selectDistrict(item)"
                            ></li>
                          </template>
                        </ul>
                      </div>
                    </div>
                    <div
                      class="form-group"
                      @click.outside="wardListShown = false"
                    >
                      <input
                        class="form-control"
                        x-model.trim="wardSearch"
                        id="ward"
                        name="ward"
                        placeholder="Ward"
                        @focus="startSearchingWard"
                        autocomplete="off"
                      />
                      <span class="form-message"></span>
                      <div
                        class="z-10 max-h-48 w-full bg-gray-100 overflow-y-auto shadow"
                        x-show="wardListShown && filteredWards.length"
                      >
                        <ul class="list-none">
                          <template
                            x-for="(item, idx) of filteredWards"
                            :key="idx"
                          >
                            <li
                              x-html="highlightName(item)"
                              class="px-2 py-1 cursor-pointer bg-white hover:bg-gray-100 seperate_line"
                              @click="selectWard(item)"
                            ></li>
                          </template>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="address-register"
                      type="text"
                      name="address-register"
                      placeholder="Address (Apt, building, street, etc)"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group" style="display: none">
                    <input
                      id="longitude"
                      name="longitude"
                      class="form-control"
                      type="text"
                      value=""
                    />
                    <input
                      id="latitude"
                      name="latitude"
                      class="form-control"
                      type="text"
                      value=""
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="password-register"
                      type="password"
                      name="password-register"
                      placeholder="Password"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group">
                    <input
                      class="form-control"
                      id="re-password-register"
                      type="password"
                      name="re-password-register"
                      placeholder="Re-enter Password"
                    />
                    <span class="form-message"></span>
                  </div>
                  <div class="form-group">
                    <button
                      onclick="btnRegister()"
                      type="button"
                      class="btn btn-block btn-round btn-b"
                    >
                      Register
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>

        <div id="toasts"></div>
        <div id="footer"></div>
      </div>
      <div class="scroll-up">
        <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
      </div>
    </main>
    <!--  
    JavaScripts
    =============================================
    -->
    <script type="module" src="./assets/js/address.js"></script>
    <script
      src="https://upload-widget.cloudinary.com/global/all.js"
      type="text/javascript"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"
    ></script>
    <script src="assets/lib/jquery/dist/jquery.js"></script>
    <script src="assets/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="assets/lib/wow/dist/wow.js"></script>
    <script src="assets/lib/jquery.mb.ytplayer/dist/jquery.mb.YTPlayer.js"></script>
    <script src="assets/lib/isotope/dist/isotope.pkgd.js"></script>
    <script src="assets/lib/imagesloaded/imagesloaded.pkgd.js"></script>
    <script src="assets/lib/flexslider/jquery.flexslider.js"></script>
    <script src="assets/lib/owl.carousel/dist/owl.carousel.min.js"></script>
    <script src="assets/lib/smoothscroll.js"></script>
    <script src="assets/lib/magnific-popup/dist/jquery.magnific-popup.js"></script>
    <script src="assets/lib/simple-text-rotator/jquery.simple-text-rotator.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/user/common.js"></script>
    <script src="./assets/js/notification.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"
      integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- <script src="./assets/js/app.js"></script> -->
    <script
      src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"
      type="text/javascript"
    ></script>
    <script src="./assets/js/validator.js"></script>

    <script>
      if (document.cookie) {
        swal(
          "Warning!",
          `You are logged in! \n We will redirect you to the account page after 5s`,
          "warning"
        );
        setTimeout(function () {
          location.replace("../tabs_and_accordions.html");
        }, 3000);
      }

      var loginForm = document.querySelector(".loginform");
      var forgotPassword = document.querySelector(".forgot-password");
      forgotPassword.style.display = "none";
      function forgotpassword() {
        loginForm.style.display = "none";
        forgotPassword.style.display = "block";
      }
      function loginform() {
        loginForm.style.display = "block";
        forgotPassword.style.display = "none";
      }

      // Login
      var loginAPI = "https://hanoifoodbank.herokuapp.com/api/v1/hfb/login";
      function login(usernamelogin, passwordlogin) {
        var formData = {
          username: usernamelogin,
          password: passwordlogin,
        };
        fetch(loginAPI, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((response) => response.json())
          .then(function (data) {
            if (data.status == 200) {
              var usernamecookie = document.querySelector(
                'input[name="username-login"]'
              ).value;
              document.cookie = `token=${data.data.access_token}`;
              document.cookie = `username=${usernamecookie}`;

              window.history.back();
            } else {
              swal("Error!", "Incorrect username or password!", "error");
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      document
        .getElementById("password-login")
        .addEventListener("keyup", function (e) {
          if (e.keyCode === 13) {
            document.getElementById("btnLogin").click();
            var username = document.querySelector(
              'input[name="username-login"]'
            ).value;
            var password = document.querySelector(
              'input[name="password-login"]'
            ).value;
            login(username, password);
          }
        });

      document
        .getElementById("username-login")
        .addEventListener("keyup", function (e) {
          if (e.keyCode === 13) {
            document.getElementById("username-login").click();
            var username = document.querySelector(
              'input[name="username-login"]'
            ).value;
            var password = document.querySelector(
              'input[name="password-login"]'
            ).value;
            login(username, password);
          }
        });

      document.getElementById("btnLogin").onclick = function () {
        var username = document.querySelector('input[name="username-login"]')
          .value;
        var password = document.querySelector('input[name="password-login"]')
          .value;
        login(username, password);
      };

      //function btnLogin() {
      //  var username = document.querySelector('input[name="username-login"]')
      //    .value;
      //  var password = document.querySelector('input[name="password-login"]')
      //    .value;
      //  login(username, password);
      //}

      // Register
      var registerAPI = "https://hanoifoodbank.herokuapp.com/api/v1/hfb/users";

      function btnRegister() {
        var fullname_register = document.getElementById("fullname-register")
          .value;
        var email_register = document.getElementById("email-register").value;
        var phone_register = document.getElementById("phone-register").value;
        var address_detail = document.getElementById("address-register").value;
        var ward = document.getElementById("ward").value;
        var district = document.getElementById("district").value;
        var province = document.getElementById("province").value;
        var full_address =
          address_detail + ", " + ward + ", " + district + ", " + province;
        var longitude = document.getElementById("longitude").value;
        var latitude = document.getElementById("latitude").value;
        var password_register = document.getElementById("password-register")
          .value;
        if (
          !fullname_register == false &&
          !email_register == false &&
          !phone_register == false &&
          !address_detail == false &&
          !password_register == false &&
          !full_address == false
        ) {
          fetch(registerAPI, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name: fullname_register,
              email: email_register,
              username: email_register,
              password: password_register,
              phone: phone_register,
              address: full_address,
              longitude: longitude,
              latitude: latitude,
              avatar:
                "v1635678562/hanoi_food_bank_project/users_avatar/null_avatar.jpg",
            }),
          })
            .then((response) => response.json())
            .then(function (data) {
              if (data.status == 200) {
                swal("Success!", `Register success!`, "success");
                login(email_register, password_register);
              } else if (data.status == 501) {
                swal("Error!", `${data.message}!`, "error");
              } else {
                swal("Error!", "Register fail!", "error");
              }
            })
            .catch(function (error) {
              swal("Error!", "Register fail!", "error");
              console.log(error);
            });
        }
      }
      // Validator Forgot
      Validator({
        form: "#form-forgot",
        formGroupSelector: ".form-group",
        errorSelector: ".form-message",
        rules: [
          Validator.isRequired("#username-forgot"),
          Validator.minLength("#password-forgot", 3),
        ],
      });

      // Validator Login
      Validator({
        form: "#form-login",
        formGroupSelector: ".form-group",
        errorSelector: ".form-message",
        rules: [
          Validator.isRequired(
            "#phone-login",
            "This field cannot be left blank"
          ),
          Validator.isPhone(
            "#phone-login",
            "Please enter correct phone number format"
          ),
          Validator.minLength(
            "#password-login",
            3,
            "Please enter at least 3 characters"
          ),
        ],
      });

      // Validator register
      Validator({
        form: "#form-register",
        formGroupSelector: ".form-group",
        errorSelector: ".form-message",
        rules: [
          Validator.isRequired(
            "#fullname-register",
            "This field cannot be left blank"
          ),
          Validator.isRequired(
            "#email-register",
            "This field cannot be left blank"
          ),
          Validator.isEmail(
            "#email-register",
            "Please enter correct email format"
          ),
          Validator.isRequired(
            "#phone-register",
            "This field cannot be left blank"
          ),
          Validator.isRequired("#province", "This field cannot be left blank"),
          Validator.isRequired("#district", "This field cannot be left blank"),
          Validator.isRequired("#ward", "This field cannot be left blank"),
          Validator.isRequired(
            "#address-register",
            "This field cannot be left blank"
          ),
          Validator.isPhone("#phone-register", "Please enter correct format"),
          Validator.isRequired(
            "#address-register",
            "This field cannot be left blank"
          ),
          Validator.minLength(
            "#password-register",
            3,
            "Please enter at least 3 characters"
          ),
          Validator.isRequired(
            "#re-password-register",
            "This field cannot be left blank"
          ),
          Validator.isConfirmed(
            "#re-password-register",
            function () {
              return document.querySelector("#form-register #password-register")
                .value;
            },
            "Re-entered password is incorrect"
          ),
        ],
        // onSubmit: function(data){
        //     // Call API
        //     console.log(data);
        // }
      });
    </script>
  </body>
</html>
